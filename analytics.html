<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Malaysia Cost of Living Analytics</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .slider-container { position: relative; }
        .range-slider {
            -webkit-appearance: none;
            appearance: none;
            height: 6px;
            border-radius: 3px;
            background: #e5e7eb;
            outline: none;
        }
        .range-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .range-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .chart-container {
            position: relative;
            height: 400px;
            margin: 20px 0;
        }
        .prediction-result {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            border-radius: 1rem;
            text-align: center;
            margin-top: 2rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        .donut-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            pointer-events: none;
            z-index: 10;
            background: white;
            border-radius: 50%;
            width: 140px;
            height: 140px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        .donut-center h4 {
            font-size: 14px;
            font-weight: 600;
            color: #374151;
            margin: 0;
        }
        .donut-center .percentage {
            font-size: 24px;
            font-weight: 700;
            color: #1f2937;
            margin: 4px 0;
        }
        .donut-center .details {
            font-size: 10px;
            color: #6b7280;
            line-height: 1.2;
        }
    </style>
<style>*, ::before, ::after{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/* ! tailwindcss v3.4.16 | MIT License | https://tailwindcss.com */*,::after,::before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}::after,::before{--tw-content:''}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.container{width:100%}@media (min-width: 640px){.container{max-width:640px}}@media (min-width: 768px){.container{max-width:768px}}@media (min-width: 1024px){.container{max-width:1024px}}@media (min-width: 1280px){.container{max-width:1280px}}@media (min-width: 1536px){.container{max-width:1536px}}.relative{position:relative}.mx-auto{margin-left:auto;margin-right:auto}.mb-2{margin-bottom:0.5rem}.mb-4{margin-bottom:1rem}.mb-6{margin-bottom:1.5rem}.mb-8{margin-bottom:2rem}.mt-2{margin-top:0.5rem}.block{display:block}.flex{display:flex}.grid{display:grid}.hidden{display:none}.min-h-screen{min-height:100vh}.w-24{width:6rem}.w-full{width:100%}.max-w-4xl{max-width:56rem}.flex-1{flex:1 1 0%}.grid-cols-1{grid-template-columns:repeat(1, minmax(0, 1fr))}.items-end{align-items:flex-end}.justify-center{justify-content:center}.gap-4{gap:1rem}.gap-6{gap:1.5rem}.gap-8{gap:2rem}.space-x-3 > :not([hidden]) ~ :not([hidden]){--tw-space-x-reverse:0;margin-right:calc(0.75rem * var(--tw-space-x-reverse));margin-left:calc(0.75rem * calc(1 - var(--tw-space-x-reverse)))}.space-y-6 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(1.5rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1.5rem * var(--tw-space-y-reverse))}.rounded-lg{border-radius:0.5rem}.rounded-md{border-radius:0.375rem}.border{border-width:1px}.border-gray-300{--tw-border-opacity:1;border-color:rgb(209 213 219 / var(--tw-border-opacity, 1))}.bg-gray-50{--tw-bg-opacity:1;background-color:rgb(249 250 251 / var(--tw-bg-opacity, 1))}.bg-blue-500{--tw-bg-opacity:1;background-color:rgb(59 130 246 / var(--tw-bg-opacity, 1))}.bg-gray-500{--tw-bg-opacity:1;background-color:rgb(107 114 128 / var(--tw-bg-opacity, 1))}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}.p-1{padding:0.25rem}.p-2{padding:0.5rem}.p-3{padding:0.75rem}.p-6{padding:1.5rem}.p-8{padding:2rem}.px-4{padding-left:1rem;padding-right:1rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.px-8{padding-left:2rem;padding-right:2rem}.py-2{padding-top:0.5rem;padding-bottom:0.5rem}.py-3{padding-top:0.75rem;padding-bottom:0.75rem}.py-8{padding-top:2rem;padding-bottom:2rem}.text-center{text-align:center}.text-2xl{font-size:1.5rem;line-height:2rem}.text-3xl{font-size:1.875rem;line-height:2.25rem}.text-4xl{font-size:2.25rem;line-height:2.5rem}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-sm{font-size:0.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.font-bold{font-weight:700}.font-medium{font-weight:500}.font-semibold{font-weight:600}.text-gray-600{--tw-text-opacity:1;color:rgb(75 85 99 / var(--tw-text-opacity, 1))}.text-gray-700{--tw-text-opacity:1;color:rgb(55 65 81 / var(--tw-text-opacity, 1))}.text-gray-800{--tw-text-opacity:1;color:rgb(31 41 55 / var(--tw-text-opacity, 1))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.opacity-90{opacity:0.9}.shadow-md{--tw-shadow:0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 4px 6px -1px var(--tw-shadow-color), 0 2px 4px -2px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.transition-all{transition-property:all;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.transition-colors{transition-property:color, background-color, border-color, fill, stroke, -webkit-text-decoration-color;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, -webkit-text-decoration-color;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.duration-200{transition-duration:200ms}.hover\:bg-blue-600:hover{--tw-bg-opacity:1;background-color:rgb(37 99 235 / var(--tw-bg-opacity, 1))}.hover\:bg-gray-600:hover{--tw-bg-opacity:1;background-color:rgb(75 85 99 / var(--tw-bg-opacity, 1))}.hover\:text-blue-500:hover{--tw-text-opacity:1;color:rgb(59 130 246 / var(--tw-text-opacity, 1))}.focus\:border-transparent:focus{border-color:transparent}.focus\:ring-2:focus{--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000)}.focus\:ring-blue-500:focus{--tw-ring-opacity:1;--tw-ring-color:rgb(59 130 246 / var(--tw-ring-opacity, 1))}@media (min-width: 768px){.md\:grid-cols-2{grid-template-columns:repeat(2, minmax(0, 1fr))}.md\:grid-cols-3{grid-template-columns:repeat(3, minmax(0, 1fr))}}@media (min-width: 1024px){.lg\:grid-cols-2{grid-template-columns:repeat(2, minmax(0, 1fr))}}</style></head>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        Papa.parse('cost_of_living.csv', {
            download: true,
            header: true,
            dynamicTyping: true,
            complete: function(results) {
                sampleData = results.data
                    .filter(row => row.State && row.District && row.Strata) // Remove empty rows
                    .map(row => ({
                        ...row,
                        State: row.State.trim(),
                        District: row.District.trim(),
                        Strata: row.Strata.trim().charAt(0).toUpperCase() + row.Strata.trim().slice(1).toLowerCase()
                    }));

                updateCharts(); // re-render all charts with clean data
            },
            error: function(err) {
                console.error('CSV load error:', err);
            }
        });
    });
</script>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">Malaysia Cost of Living Analytics</h1>
            <p class="text-gray-600">Interactive visualization and poverty prediction across states and districts</p>
        </div>

        <!-- Tab Navigation -->
        <div class="flex justify-center mb-8">
            <div class="bg-white rounded-lg shadow-md p-1">
                <button onclick="switchTab('charts')" id="charts-tab" class="tab-btn px-6 py-3 rounded-md font-medium transition-all duration-200 bg-blue-500 text-white">
                    ðŸ“Š Charts
                </button>
                <button onclick="switchTab('predict')" id="predict-tab" class="tab-btn px-6 py-3 rounded-md font-medium transition-all duration-200 text-gray-600 hover:text-blue-500">
                    ðŸ“ˆ Predict
                </button>
            </div>
        </div>

        <!-- Charts Tab -->
        <div id="charts-content" class="tab-content active">
            <!-- Filters -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-8">
                <h3 class="text-lg font-semibold mb-4">Filters</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">State</label>
                        <select id="state-filter" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="All">All States</option>
                        <option value="Johor">Johor</option><option value="Kedah">Kedah</option><option value="Kelantan">Kelantan</option><option value="Melaka">Melaka</option><option value="Negeri Sembilan">Negeri Sembilan</option><option value="Pahang">Pahang</option><option value="Perak">Perak</option><option value="Perlis">Perlis</option><option value="Pulau Pinang">Pulau Pinang</option><option value="Sabah">Sabah</option><option value="Sarawak">Sarawak</option><option value="Selangor">Selangor</option><option value="Terengganu">Terengganu</option><option value="Kuala Lumpur">Kuala Lumpur</option></select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Strata</label>
                        <select id="strata-filter" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="All">All</option>
                            <option value="Urban">Urban</option>
                            <option value="Rural">Rural</option>
                        </select>
                    </div>
                    <div class="flex items-end">
                        <button onclick="resetFilters()" class="w-full bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-md transition-colors duration-200">
                            Reset Filters
                        </button>
                    </div>
                </div>
            </div>

            <!-- Charts Grid -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Stacked Bar Chart -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold mb-4">Income &amp; Expenditure by District</h3>
                    <div class="chart-container">
                        <canvas id="stackedBarChart" width="560" height="400" style="display: block; box-sizing: border-box; height: 400px; width: 560px;"></canvas>
                    </div>
                </div>

                <!-- Donut Chart -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold mb-4">Urban vs Rural Distribution</h3>
                    <div class="chart-container relative">
                        <canvas id="donutChart" width="560" height="400" style="display: block; box-sizing: border-box; height: 400px; width: 560px;"></canvas>
                        <div id="donut-center" class="donut-center">
                            <h4 id="center-strata">Overall</h4>
                            <div id="center-percentage" class="percentage">100%</div>
                            <div id="center-details" class="details">
                <div>Mean Income: RM 7,222</div>
                <div>Gini: 0.456</div>
                <div>Poverty: 21.6%</div>
            </div>
                        </div>
                    </div>
                </div>

                <!-- Tree Map (Simulated with Bar Chart) -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold mb-4">Gini Coefficient by District</h3>
                    <div class="chart-container">
                        <canvas id="treeMapChart" width="560" height="400" style="display: block; box-sizing: border-box; height: 400px; width: 560px;"></canvas>
                    </div>
                </div>

                <!-- Poverty Rate Chart -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold mb-4">Average Poverty Rate by State</h3>
                    <div class="chart-container">
                        <canvas id="povertyChart" width="560" height="400" style="display: block; box-sizing: border-box; height: 400px; width: 560px;"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Predict Tab -->
        <div id="predict-content" class="tab-content">
            <div class="max-w-4xl mx-auto">
                <div class="bg-white rounded-lg shadow-md p-8">
                    <h3 class="text-2xl font-semibold mb-6 text-center">Poverty Rate Prediction</h3>
                    
                    <form id="prediction-form" class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Strata -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Strata</label>
                                <select id="pred-strata" class="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <option value="Urban">Urban</option>
                                    <option value="Rural">Rural</option>
                                </select>
                            </div>

                            <!-- PLI -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">PLI (Poverty Line Income)</label>
                                <div class="flex space-x-3">
                                    <input type="range" id="pli-slider" class="range-slider flex-1" min="500" max="3000" value="1750">
                                    <input type="number" id="pli-input" class="w-24 p-2 border border-gray-300 rounded-md text-center" min="500" max="3000" value="1750">
                                </div>
                            </div>

                            <!-- PAKW -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">PAKW (Per Adult Equivalent)</label>
                                <div class="flex space-x-3">
                                    <input type="range" id="pakw-slider" class="range-slider flex-1" min="400" max="2500" value="1450">
                                    <input type="number" id="pakw-input" class="w-24 p-2 border border-gray-300 rounded-md text-center" min="400" max="2500" value="1450">
                                </div>
                            </div>

                            <!-- Median Income -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Median Income (RM)</label>
                                <div class="flex space-x-3">
                                    <input type="range" id="med-income-slider" class="range-slider flex-1" min="800" max="15000" value="7900">
                                    <input type="number" id="med-income-input" class="w-24 p-2 border border-gray-300 rounded-md text-center" min="800" max="15000" value="7900">
                                </div>
                            </div>

                            <!-- Mean Income -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Mean Income (RM)</label>
                                <div class="flex space-x-3">
                                    <input type="range" id="mean-income-slider" class="range-slider flex-1" min="900" max="20000" value="10450">
                                    <input type="number" id="mean-income-input" class="w-24 p-2 border border-gray-300 rounded-md text-center" min="900" max="20000" value="10450">
                                </div>
                            </div>

                            <!-- Median Expenditure -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Median Expenditure (RM)</label>
                                <div class="flex space-x-3">
                                    <input type="range" id="med-exp-slider" class="range-slider flex-1" min="600" max="12000" value="6300">
                                    <input type="number" id="med-exp-input" class="w-24 p-2 border border-gray-300 rounded-md text-center" min="600" max="12000" value="6300">
                                </div>
                            </div>

                            <!-- Mean Expenditure -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Mean Expenditure (RM)</label>
                                <div class="flex space-x-3">
                                    <input type="range" id="mean-exp-slider" class="range-slider flex-1" min="700" max="18000" value="9350">
                                    <input type="number" id="mean-exp-input" class="w-24 p-2 border border-gray-300 rounded-md text-center" min="700" max="18000" value="9350">
                                </div>
                            </div>

                            <!-- Gini Coefficient -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Gini Coefficient</label>
                                <div class="flex space-x-3">
                                    <input type="range" id="pred-gini-slider" class="range-slider flex-1" min="0" max="1" step="0.001" value="0.400">
                                    <input type="number" id="pred-gini-input" class="w-24 p-2 border border-gray-300 rounded-md text-center" min="0" max="1" step="0.001" value="0.400">
                                </div>
                            </div>
                        </div>

                        <div class="text-center">
                            <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-8 py-3 rounded-lg font-semibold transition-colors duration-200 shadow-md">
                                ðŸ”® Predict Poverty Rate
                            </button>
                        </div>
                    </form>

                    <div id="prediction-result" class="prediction-result hidden">
                        <h4 class="text-xl font-semibold mb-2">Prediction Result</h4>
                        <div class="text-3xl font-bold" id="poverty-percentage">--.--%</div>
                        <p class="text-sm opacity-90 mt-2">Estimated Absolute Poverty Rate</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Sample data generation
        const states = [
            'Johor', 'Kedah', 'Kelantan', 'Melaka', 'Negeri Sembilan', 'Pahang', 
            'Perak', 'Perlis', 'Pulau Pinang', 'Sabah', 'Sarawak', 'Selangor', 
            'Terengganu', 'W.P.'
        ];

        const districts = {
            'Johor': ['Batu Pahat', 'Johor Bahru', 'Kluang', 'Kota Tinggi', 'Kulai', 'Mersing', 'Muar', 'Pontian', 'Segamat', 'Tangkak'],
            'Kedah': ['Baling', 'Bandar Baharu', 'Kota Setar', 'Kubang Pasu', 'Kulim', 'Langkawi', 'Padang Terap', 'Pendang', 'Pokok Sena', 'Sik', 'Yan'],
            'Kelantan': ['Bachok', 'Kota Bharu', 'Machang', 'Pasir Mas', 'Pasir Puteh', 'Tanah Merah', 'Tumpat'],
            'Melaka': ['Alor Gajah', 'Jasin', 'Melaka Tengah'],
            'Negeri Sembilan': ['Jelebu', 'Jempol', 'Kuala Pilah', 'Port Dickson', 'Rembau', 'Seremban'],
            'Pahang': ['Bentong', 'Bera', 'Cameron Highlands', 'Jerantut', 'Kuantan', 'Lipis', 'Maran', 'Pekan', 'Raub', 'Rompin', 'Temerloh'],
            'Perak': ['Batang Padang', 'Hilir Perak', 'Hulu Perak', 'Hulu Perak', 'Kampar', 'Kerian', 'Kerian', 'Kinta', 'Kuala Kangsar', 'Larut, Matang & Selama', 'Manjung', 'Muallim', 'Selama'],
            'Perlis': ['Perlis', 'Perlis (state)'],
            'Pulau Pinang': ['Barat Daya', 'Seberang Perai Selatan', 'Seberang Perai Tengah', 'Seberang Perai Utara', 'Timur Laut'],
            'Sabah': ['Beaufort', 'Kota Kinabalu', 'Kudat', 'Lahad Datu', 'Sandakan', 'Tawau', 'Tuaran'],
            'Sarawak': ['Bintulu', 'Kapit', 'Kuching', 'Limbang', 'Miri', 'Samarahan', 'Sarikei', 'Serian', 'Sibu', 'Sri Aman'],
            'Selangor': ['Gombak', 'Hulu Langat', 'Hulu Selangor', 'Klang', 'Kuala Langat', 'Kuala Selangor', 'Petaling', 'Sabak Bernam', 'Sepang'],
            'Terengganu': ['Besut', 'Dungun', 'Hulu Terengganu', 'Kemaman', 'Kuala Nerus', 'Kuala Terengganu', 'Marang', 'Setiu'],
            'W.P.': ['Kuala Lumpur', 'Labuan', 'Putrajaya'],
        };

        // Generate sample data
        /* function generateSampleData() {
            const data = [];
            states.forEach(state => {
                districts[state].forEach(district => {
                    ['Urban', 'Rural'].forEach(strata => {
                        const baseIncome = strata === 'Urban' ? 8000 : 4000;
                        const variance = 0.3;
                        
                        data.push({
                            State: state,
                            District: district,
                            Strata: strata,
                            PLI: Math.round(500 + Math.random() * 2500),
                            PAKW: Math.round(400 + Math.random() * 2100),
                            Median_Income: Math.round(baseIncome * (1 + (Math.random() - 0.5) * variance)),
                            Mean_Income: Math.round(baseIncome * 1.2 * (1 + (Math.random() - 0.5) * variance)),
                            Median_Expenditure: Math.round(baseIncome * 0.8 * (1 + (Math.random() - 0.5) * variance)),
                            Mean_Expenditure: Math.round(baseIncome * 0.9 * (1 + (Math.random() - 0.5) * variance)),
                            Gini_Coefficient: Math.round((0.25 + Math.random() * 0.4) * 1000) / 1000,
                            Absolute_Poverty: Math.round((Math.random() * 30 + (strata === 'Rural' ? 10 : 5)) * 10) / 10
                        });
                    });
                });
            });
            return data;
        } */

        let sampleData = [];
        let charts = {};

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            populateStateFilter();
            initializeCharts();
            setupSliderSync();
            setupFilters();
        });

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('bg-blue-500', 'text-white');
                btn.classList.add('text-gray-600');
            });
            
            document.getElementById(tabName + '-content').classList.add('active');
            document.getElementById(tabName + '-tab').classList.add('bg-blue-500', 'text-white');
            document.getElementById(tabName + '-tab').classList.remove('text-gray-600');
        }

        // Populate state filter
        function populateStateFilter() {
            const stateFilter = document.getElementById('state-filter');
            states.forEach(state => {
                const option = document.createElement('option');
                option.value = state;
                option.textContent = state;
                stateFilter.appendChild(option);
            });
        }

        // Filter data based on current filter settings
        function getFilteredData() {
            const stateFilter = document.getElementById('state-filter').value;
            const strataFilter = document.getElementById('strata-filter').value;
            console.log('Filtering with:', stateFilter, strataFilter);

            return sampleData.filter(item => {
                return (stateFilter === 'All' || item.State === stateFilter) &&
                       (strataFilter === 'All' || item.Strata === strataFilter);
            });
        }

        // Initialize all charts
        function initializeCharts() {
            createStackedBarChart();
            createDonutChart();
            createTreeMapChart();
            createPovertyChart();
        }

        // Stacked Bar Chart
        function createStackedBarChart() {
            const ctx = document.getElementById('stackedBarChart').getContext('2d');
            const filteredData = getFilteredData();
            const selectedState = document.getElementById('state-filter').value;
            
            let chartData = filteredData;
            if (selectedState !== 'All') {
                chartData = filteredData.filter(item => item.State === selectedState);
            } else {
                chartData = filteredData.slice(0, 10); // Limit for readability
            }

            const labels = [...new Set(chartData.map(item => item.District))];
            
            const datasets = [
                {
                    label: 'Median Income',
                    data: labels.map(district => {
                        const item = chartData.find(d => d.District === district);
                        return item ? item.Median_Income : 0;
                    }),
                    backgroundColor: 'rgba(59, 130, 246, 0.8)',
                    borderColor: 'rgba(59, 130, 246, 1)',
                    borderWidth: 1
                },
                {
                    label: 'Mean Income',
                    data: labels.map(district => {
                        const item = chartData.find(d => d.District === district);
                        return item ? item.Mean_Income : 0;
                    }),
                    backgroundColor: 'rgba(16, 185, 129, 0.8)',
                    borderColor: 'rgba(16, 185, 129, 1)',
                    borderWidth: 1
                },
                {
                    label: 'Median Expenditure',
                    data: labels.map(district => {
                        const item = chartData.find(d => d.District === district);
                        return item ? item.Median_Expenditure : 0;
                    }),
                    backgroundColor: 'rgba(245, 158, 11, 0.8)',
                    borderColor: 'rgba(245, 158, 11, 1)',
                    borderWidth: 1
                },
                {
                    label: 'Mean Expenditure',
                    data: labels.map(district => {
                        const item = chartData.find(d => d.District === district);
                        return item ? item.Mean_Expenditure : 0;
                    }),
                    backgroundColor: 'rgba(239, 68, 68, 0.8)',
                    borderColor: 'rgba(239, 68, 68, 1)',
                    borderWidth: 1
                }
            ];

            if (charts.stackedBar) {
                charts.stackedBar.destroy();
            }

            charts.stackedBar = new Chart(ctx, {
                type: 'bar',
                data: { labels, datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { stacked: true },
                        y: { 
                            stacked: true,
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'RM ' + value.toLocaleString();
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': RM ' + context.parsed.y.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }

        // Donut Chart with Interactive Center
        function createDonutChart() {
            const ctx = document.getElementById('donutChart').getContext('2d');
            const filteredData = getFilteredData();
            const selectedState = document.getElementById('state-filter').value;
            
            let chartData = filteredData;
            if (selectedState !== 'All') {
                chartData = filteredData.filter(item => item.State === selectedState);
            }

            const urbanData = chartData.filter(item => item.Strata === 'Urban');
            const ruralData = chartData.filter(item => item.Strata === 'Rural');
            
            const urbanCount = urbanData.length;
            const ruralCount = ruralData.length;
            const total = urbanCount + ruralCount;

            // Calculate averages for each strata
            const urbanStats = urbanData.length > 0 ? {
                meanIncome: urbanData.reduce((sum, item) => sum + item.Mean_Income, 0) / urbanData.length,
                gini: urbanData.reduce((sum, item) => sum + item.Gini_Coefficient, 0) / urbanData.length,
                poverty: urbanData.reduce((sum, item) => sum + item.Absolute_Poverty, 0) / urbanData.length
            } : { meanIncome: 0, gini: 0, poverty: 0 };

            const ruralStats = ruralData.length > 0 ? {
                meanIncome: ruralData.reduce((sum, item) => sum + item.Mean_Income, 0) / ruralData.length,
                gini: ruralData.reduce((sum, item) => sum + item.Gini_Coefficient, 0) / ruralData.length,
                poverty: ruralData.reduce((sum, item) => sum + item.Absolute_Poverty, 0) / ruralData.length
            } : { meanIncome: 0, gini: 0, poverty: 0 };

            if (charts.donut) {
                charts.donut.destroy();
            }

            // Update center with default info
            updateDonutCenter('Overall', selectedState !== 'All' ? selectedState : 'All States', {
                meanIncome: (urbanStats.meanIncome + ruralStats.meanIncome) / 2,
                gini: (urbanStats.gini + ruralStats.gini) / 2,
                poverty: (urbanStats.poverty + ruralStats.poverty) / 2
            }, total > 0 ? '100%' : '0%');

            charts.donut = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Urban', 'Rural'],
                    datasets: [{
                        data: [urbanCount, ruralCount],
                        backgroundColor: [
                            'rgba(59, 130, 246, 0.8)',
                            'rgba(16, 185, 129, 0.8)'
                        ],
                        borderColor: [
                            'rgba(59, 130, 246, 1)',
                            'rgba(16, 185, 129, 1)'
                        ],
                        borderWidth: 3,
                        hoverBackgroundColor: [
                            'rgba(59, 130, 246, 0.9)',
                            'rgba(16, 185, 129, 0.9)'
                        ],
                        hoverBorderWidth: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '60%',
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const percentage = total > 0 ? ((context.parsed / total) * 100).toFixed(1) : 0;
                                    return context.label + ': ' + percentage + '% (' + context.parsed + ' districts)';
                                }
                            }
                        }
                    },
                    onHover: (event, elements) => {
                        if (elements.length > 0) {
                            const index = elements[0].index;
                            const strata = index === 0 ? 'Urban' : 'Rural';
                            const stats = index === 0 ? urbanStats : ruralStats;
                            const count = index === 0 ? urbanCount : ruralCount;
                            const percentage = total > 0 ? ((count / total) * 100).toFixed(1) + '%' : '0%';
                            
                            updateDonutCenter(strata, selectedState !== 'All' ? selectedState : 'All States', stats, percentage);
                        } else {
                            // Reset to overall stats
                            updateDonutCenter('Overall', selectedState !== 'All' ? selectedState : 'All States', {
                                meanIncome: (urbanStats.meanIncome + ruralStats.meanIncome) / 2,
                                gini: (urbanStats.gini + ruralStats.gini) / 2,
                                poverty: (urbanStats.poverty + ruralStats.poverty) / 2
                            }, '100%');
                        }
                    }
                }
            });
        }

        // Update donut center content
        function updateDonutCenter(strata, state, stats, percentage) {
            document.getElementById('center-strata').textContent = strata;
            document.getElementById('center-percentage').textContent = percentage;
            
            const meanIncome = stats.meanIncome > 0 ? 'RM ' + Math.round(stats.meanIncome).toLocaleString() : '--';
            const gini = stats.gini > 0 ? stats.gini.toFixed(3) : '--';
            const poverty = stats.poverty > 0 ? stats.poverty.toFixed(1) + '%' : '--%';
            
            document.getElementById('center-details').innerHTML = `
                <div>Mean Income: ${meanIncome}</div>
                <div>Gini: ${gini}</div>
                <div>Poverty: ${poverty}</div>
            `;
        }

        // Tree Map Chart (simulated with horizontal bar chart)
        function createTreeMapChart() {
            const ctx = document.getElementById('treeMapChart').getContext('2d');
            const filteredData = getFilteredData();
            
            const chartData = filteredData.slice(0, 15); // Limit for readability
            const labels = chartData.map(item => item.District);
            const giniData = chartData.map(item => item.Gini_Coefficient);

            if (charts.treeMap) {
                charts.treeMap.destroy();
            }

            charts.treeMap = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Gini Coefficient',
                        data: giniData,
                        backgroundColor: giniData.map(value => 
                            `rgba(239, 68, 68, ${0.3 + value * 0.7})`
                        ),
                        borderColor: 'rgba(239, 68, 68, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            beginAtZero: true,
                            max: 1
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const item = chartData[context.dataIndex];
                                    return `${item.District} (${item.Strata}): ${context.parsed.x.toFixed(3)}`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // Poverty Chart
        function createPovertyChart() {
            const ctx = document.getElementById('povertyChart').getContext('2d');
            const filteredData = getFilteredData();
            
            const stateAverages = {};
            states.forEach(state => {
                const stateData = filteredData.filter(item => item.State === state);
                if (stateData.length > 0) {
                    const avgPoverty = stateData.reduce((sum, item) => sum + item.Absolute_Poverty, 0) / stateData.length;
                    stateAverages[state] = avgPoverty;
                }
            });

            const labels = Object.keys(stateAverages);
            const data = Object.values(stateAverages);

            if (charts.poverty) {
                charts.poverty.destroy();
            }

            charts.poverty = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Average Poverty Rate (%)',
                        data: data,
                        backgroundColor: 'rgba(168, 85, 247, 0.8)',
                        borderColor: 'rgba(168, 85, 247, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value.toFixed(1) + '%';
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'Poverty Rate: ' + context.parsed.y.toFixed(1) + '%';
                                }
                            }
                        }
                    }
                }
            });
        }

        // Setup filters
        function setupFilters() {
            const filters = ['state-filter', 'strata-filter'];
            filters.forEach(filterId => {
                document.getElementById(filterId).addEventListener('change', updateCharts);
            });
        }

        // Update all charts
        function updateCharts() {
            createStackedBarChart();
            createDonutChart();
            createTreeMapChart();
            createPovertyChart();
            console.log('Filtered rows:', getFilteredData().length);
        }

        // Reset filters
        function resetFilters() {
            document.getElementById('state-filter').value = 'All';
            document.getElementById('strata-filter').value = 'All';
            updateCharts();
        }

        // Setup slider synchronization
        function setupSliderSync() {
            const sliderPairs = [
                ['pli-slider', 'pli-input'],
                ['pakw-slider', 'pakw-input'],
                ['med-income-slider', 'med-income-input'],
                ['mean-income-slider', 'mean-income-input'],
                ['med-exp-slider', 'med-exp-input'],
                ['mean-exp-slider', 'mean-exp-input'],
                ['pred-gini-slider', 'pred-gini-input']
            ];

            sliderPairs.forEach(([sliderId, inputId]) => {
                const slider = document.getElementById(sliderId);
                const input = document.getElementById(inputId);

                slider.addEventListener('input', function() {
                    input.value = this.value;
                });

                input.addEventListener('input', function() {
                    const min = parseFloat(slider.min);
                    const max = parseFloat(slider.max);
                    const value = Math.min(Math.max(parseFloat(this.value), min), max);
                    this.value = value;
                    slider.value = value;
                });
            });
        }

        // Handle prediction form
        document.getElementById('prediction-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = {
                strata: document.getElementById('pred-strata').value,
                pli: parseFloat(document.getElementById('pli-input').value),
                pakw: parseFloat(document.getElementById('pakw-input').value),
                median_income: parseFloat(document.getElementById('med-income-input').value),
                mean_income: parseFloat(document.getElementById('mean-income-input').value),
                median_expenditure: parseFloat(document.getElementById('med-exp-input').value),
                mean_expenditure: parseFloat(document.getElementById('mean-exp-input').value),
                gini_coefficient: parseFloat(document.getElementById('pred-gini-input').value)
            };

            // Mock prediction (replace with actual API call)
            // const mockPrediction = Math.random() * 50;
            
            //document.getElementById('poverty-percentage').textContent = mockPrediction.toFixed(2) + '%';
            //document.getElementById('prediction-result').classList.remove('hidden');

            fetch('http://127.0.0.1:5000/predict', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(formData)
            })
            .then(res => res.json())
            .then(data => {
                if (data.prediction !== undefined) {
                    document.getElementById('poverty-percentage').textContent = data.prediction.toFixed(1) + '%';
                } else {
                    document.getElementById('poverty-percentage').textContent = 'Error';
                    console.error(data.error);
                }
                document.getElementById('prediction-result').classList.remove('hidden');
                document.getElementById('prediction-result').scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'center' 
                });
            })
            .catch(err => {
                console.error('Request failed:', err);
                document.getElementById('poverty-percentage').textContent = 'Network Error';
                document.getElementById('prediction-result').classList.remove('hidden');
            });
        });
    </script>
</body></html>